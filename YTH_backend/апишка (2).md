- общая информация для всех запросов:
	- про токены
		- при регистрации и входе будут создаваться 2 токена: access_token и refresh_token
		- про эту схему с двумя токенами:
			- https://habr.com/ru/companies/Voximplant/articles/323160/
		- но если кратко:
			- access токен короткоживущий, его нужно будет посылать с каждым запросом в заголовке Authorization
			- refresh - долгоживущий, хранится в HttpOnly+Secure куках (к нему нет доступа из js)
			- если access истечет, нужно сделать запрос на /refresh, чтобы обновить оба токена
			- если refresh истечет, нужно будет снова залогиниться по паролю
		- access токен - это jwt со следующим содержимым:
			- ```json
				{
					"sub": "asdfasds", // id пользователя
					"iat": 1697130000, // время выдачи (в формате Unix Time)
					"exp": 1697130600, // время истечения (в формате Unix Time)
					"jti": "asdfasfa" // id токена (чтобы можно было при выходе добавить его в blacklist, пока он не истечет)
				}
			  ```
		  - refresh токен - это просто случайная строка
		  - время жизни у них:
			  - у access - около 10 мин
			  - у refresh - около 7 дней
			  - ==нужно спросить у заказчиков, как часто пользуются этим сервисом. Если редко - можно сделать время жизни побольше
	- про ошибки
		- формат
			- в теле ответа всегда будет как минимум 2 поля: код ошибки и сообщение для отладки (которое нельзя показывать пользователям в сыром виде): `{"error_code": "urn:error:tooManyRequests", "message": "..."}`
			- ==нужно будет конкретно прописать все id-шники всех возможных ошибок, чтобы на фронте это как то обрабатывать==
		- общие ошибки для любых запросов:
			- 405 Method Not Allowed 
				- если серверу метод известен, но указанный в запросе метод не поддерживаем для ресурса. Например, использование POST/PUT для ресурса, доступного только на чтение через GET. В ответ можно включить заголовок Allow, содержащий список допустимых методов.
			- 429 Too Many Request
				- Штобы не флудили!
			- 500
				- при ошибках сервака
		- общие ошибки для любых запросов после входа (если не сказано обратного) 
			- 401 Unauthorized
				- если access или refresh токен истек
	- общие заголовки для любых запросов после входа (если не сказано обратного)
		- `Authorization: Bearer {access_token}`
	- про пагинацию
		- у любого запроса списка ресурсов будет одинаковая пагинация:
		- ?from={id}&take={count}&orderBy={{fieldName}:asc/desc, ...} (GET) 
			- query параметры:
				- from - с какого элемента включительно начинать (не обязательное, по умолчанию берется первый элемент)
				- take - сколько элементов взять
				- orderBy 
					- не обязательное, по умолчанию сортирует по id
					- при любой сортировке при одинаковых значениях всех выбранных полей так же сортируется по id
			- ответы:
				- 200
					- ```json
						{
						  "total": 124, // общее число элементов
						  "parameters": { // параметры запроса, чтобы можно было понять, откуда эти данные без дополнительной информации
							  "from": 213414124,
							  "take": 50,
							  "orderBy": "date:desc,name:asc",
						  },
						  "actualTake": 24, // сколько реально удалось получить 
						  "items": [
							...
						  ]
						}
						```
				- 404 - если id из from не существует
				- 400 - если заданы некорректные параметры, например
					- если take не указан
					- если take отрицательное
					- если у orderBy некорректный формат (нет + или - вначале)
					- если в orderBy указано несуществующее поле или поле, по которому невозможно сортироваться (например поле типа список)

- шаблон:
	- ендпоинт (метод) - описание
		- заголовки (если есть)
			- ...
		- тело запроса (если есть)
			- ...
		- ответы:
			- код - описание
				- заголовки (если есть)
					- ...
				- тело (если есть)
					- ...
			- ...

- todo:
	- на будущее:
		- [ ] добавить поиск/фильтрацию для ресурсов (постов, курсов, евентов, тегов)
	- [ ] продумать защиту от csrf
	- [ ] добавить аутентификацию в moodle (сначала надо посмотреть, как оно там работает)

- /api/v0
	- /users  
		- (POST) - создает неподтвержденного пользователя    
			- заголовки: 
				- нет, токен не нужен
			- тело:
				- обязательные поля :  
					- username
						- str,<256 латинских символов, цифр или подчеркиваний  
					- email
						- str, валидная почта  
					- password/passwordHash
						- str 
						- пока хз, где лучше хешировать - только на сервере или и там и там
					- role
						- str, из {"Student", "Expert", "Admin"}
				- необязательные поля:
					- admin_key
						- str
						- инвайт-ключ, по которому можно зарегать нового админа
						- такие ключи могут генерировать только уже существующие админы
			- ответы:
				- успешные
					- 201 - успешно создано
						- тело: `{ "access_token": "...", "refresh_token": "..." }`
				- ошибки
					- 403 Forbidden 
						- если указана роль админа, но нет инвайта, либо инвайт не действителен
					- 409 Conflict 
						- если пользователь с данной почтой/юзернеймом уже существует
					- 400 
						- при прочих ошибках
		- /{id}/personalData (GET) - возвращает персональные данные для лк (работает только на себя)
			- ответы:
				- 200 - ок
					- тело:
						- ```json
							{
								"id": "asdfasd-asdfasdf-asdfsdf",
							    "fullName": "Иванов Иван Иваныч",
							    "username": "IvanovIvan123", 
							    "role": "Expert", // из {Student, Expert, Admin}
							    "birthDate": "1985-03-15",
							    "address": "г. Москва, ул. Примерная, д. 10",
							    "phone": "+79991234567",
							    "avatarUrl": "https://example.com/static/avatar.jpg"
							}
						  ```
					  - birthDate, address, phone, avatarUrl - могут отсутствовать
				- 403/404
		- /{id} (GET) - возвращает публичные данные 
			- ответы:
				- 200
					- ```json
						{
							"id": "asdfa-asdf-asdf",
							"fullName": "Иванов Иван Иваныч",
							"username": "IvanovIvan123", 
							"role": "Expert", // из {Student, Expert, Admin}
							"avatarUrl": "https://example.com/static/avatar.jpg"
						}
						```
				- 404
		- /{id} (PATCH) - редактирование полей (работает только на себя)
			- тело: в формате [JSONPATCH](http://jsonpatch.com/)
			- ответы:
				- 204/400/403/404
		- /{id} (DELETE) - удаляет пользователя (работает только на себя) 
			- (хз нужно ли)
			- ответы: 204/403/404

	- /auth
		- /login (POST) - вход по паролю
			- заголовки: 
				- нет, токен не нужен
			- тело:
				- email
				- пароль/хеш пароля ==(пока хз, стоит ли хешировать дважды)==
			- ответы:
				- 200 - ок
					- тело: `{ "access_token": "...", "refresh_token": "..." }`
				- 400 
					- указана несуществующая почта
					- неверный пароль
				- 429
					- тут будет особо строгое ограничение по попыткам входа
		- /sendVerificationEmail (POST) - генерирует jwt токен и отправляет на почту ссылку для подтверждения почты
			- содержание jwt токена: {token: str, user_id: int, iat: int, exp: int}
			- ответы:
				- 204 - No Content
		- /verify?key={key} (GET (чтобы можно было просто кликнуть на ссылку)) - верифицирует пользователя
			- заголовки: 
				- нет, токен не нужен
			- ответы:
				- 200 ok
					- в теле: `{ "access_token": "...", "refresh_token": "..." }`
				- 400
					- Если срок действия ссылки истек
		- /refresh (POST)
			- заголовки:
				- ==вроде refresh_token должен передаваться автоматически, но не уверен
				- access токен не нужен
			- ответы:
				- 200 - ок
					- тело: `{ "access_token": "...", "refresh_token": "..." }` (обновляет оба токена)
				- 401 - если refresh токен истек
		- /logout (POST) - выходит с устройства, деактивирует refresh и access токен
			- заголовки:
				- refresh токен (передается автоматически)
				- access токен не нужен
			- ответы:
				- 204 No Content
				- ошибок тут быть не может (даже если refresh уже истек, то все равно вернется 204, так просрочить токен это по сути то же самое, что выйти)
		- /changePassword (POST)
			- тело: `{old_password: ..., new_password: ...}`
			- ответы:
				- 204/400
		- /forgotPassword (POST) - отправляет на почту ссылку с jwt для сброса пароля
			- содержимое jwt токена: user_id, iat, exp 
			- Ответы: 204
		- /resetPassword (POST)
			- тело:
				- `{token: ..., new_password: ...}` (token - jwt токен для сброса, который был отправлен на почту)
			- ответы:
				- 204
				- 400, если тело в неверном формате или пароль слишком короткий
				- 403, если токен устарел или подделан

	- /admins
		- (POST) - добавить админа (это может делать только админ)
			- тело: `{"user_id": ...}`
			- ответы:
				- 201
					- ```json
						{
							"id": str,
							"appointor_id": str,
							"appointee_id": str,
							"created_at": str // datetime в iso
						}
					  ```
				- 400
				- 403 (если это пытается сделать не админ)
				- 404
				- 409 (если пользователь уже админ)
		- /{appointee_id}/revoke (POST) - отозвать админку
			- тело: `{"reason": str}`
			- ответы
				- 200
					- ```json
						{
							"id": str,
							"appointor_id": str,
							"appointee_id": str,
							"created_at": str, // datetime в iso
							"revoked_by": str,
							"revoked_at": str,
							"reason": str,
						}
					  ```
				- 400
				- 403 (разжаловать может только тот кто назначил или тот, (кто назначил того, кто)+ назначил )
				- 404
				- 409 (если он и не был админом)
		- ?{параметры пагинации} (GET) - посмотреть кто кого когда назначал 
			- ответы:
				- 200
					- ```json
						{
							// обертка
							"items": [
								{  
								    "id": str,  
								    "appointor_id": str,  
								    "appointee_id": str,  
								    "role": str,  
								    "created_at": str,  
								    "revoked_at": str,  
								    "revoked_by": str,  
								    "revoke_reason": str,  
								}, ...
							]
						}
					  ```
				- 400
				- 403 (доступно только админам)

	- /users/{id}/courses  
		- ?{параметры пагинации} (GET) - получение своих курсов с пагинацией
			- ответы:
				- 200
					- ```json
						{
						  // обертка
						  "items": [
						    {
						      "id": "aaaa-aaaa-aaaa-aaaa",
						      "name": "Основы Python",
						      "short_description": "Введение в синтаксис и типы данных",
						      "description": "Подробный курс по Python с примерами кода",
						      "link": "https://example.com/courses/python-basics",
						      "category": {
						        "id": "aaaa-aaaa-aaaa-aaaa",
						        "name": "Программирование"
						      },
						      "tags": [
						        {"id": "aaaa-aaaa-aaaa-aaaa", "name": "Backend"},
						        {"id": "aaaa-aaaa-aaaa-aaaa", "name": "Python"}
						      ]
						    },
						    ...
						  ]
						}
						```
				- 400/403/404
		- (POST) - добавить курс себе  
			- тело запроса:
				- `{"course_id": "aaaa-aaaa-aaaa-aaaa"}`
			- ответы:
				- 204 No Content
				- 403 Forbidden, если это попытка поменять что то у другого пользователя
				- 404 Not Found, если указанного курса не существует  
				- 409 Conflict, если курс уже добавлен пользователю  
		- /{course_id} (DELETE) - удалить курс у себя  
			- ответы:
				- 200
				- 403
				- 404 Not Found, если пользователь не был подписан на этот курс  					```
	
	- /users/{id}/events (почти то же, что и для курсов)
		- ?{параметры пагинации} (GET) - получение своих евентов с пагинацией
			- query параметры: 
				- те же, что и у курсов
			- ответы:
				- 200
					- тело:
						```json
						{
						  // обертка
						  "items": [
						    {
						      "id": "aaaa-aaaa-aaaa-aaaa",
						      "name": "Выпускной в 1й школе",
							  "date": "2025-10-12 07:16:00",
						      "short_description": "выпускной",
						      "description": "выпускной выпускной",
						      "eventType": "Offline", // или "Online"
						      "adress": "Плотинка",
						      "category": {
						        "id": "aaaa-aaaa-aaaa-aaaa",
						        "name": "Выпускные"
						      },
						      "tags": [
						        {"id": "aaaa-aaaa-aaaa-aaaa", "name": "яхз"},
						        {"id": "aaaa-aaaa-aaaa-aaaa", "name": "чтотутможетбыть"}
						      ]
						    },
						    ...
						  ]
						}
						```
				- 400/403/404
		- (POST) - добавить евент себе  
			- тело запроса:
				- `{"event_id": "aaaa-aaaa-aaaa-aaaa"}`
			- ответы те же, что и у курсов
		- /{event_id} (DELETE) - удалить евент у себя  
			- ответы те же, что и у курсов				```
	
	- /posts  
		- ?{параметры пагинации} (GET) - получение списка постов с пагинацией
			- заголовки: нет, токен не нужен  
			- ответы:  
				- 200  
					- тело 
						- по умолчанию сортируется по `-created_at`
						- ```json
							{
							  // обертка
							  "items": [
							    {
								  "id": "aaaa-aaaa-aaaa-aaaa",
								  "author_id": "aaaa-aaaa-aaaa-aaaa",
								  "category": {
									"id": "aaaa-aaaa-aaaa-aaaa",
									"name": "...",
								  },
								  "title": "...",
								  "short_description": "..." ,
								  "description": "...",
								  "created_at": "2025-10-12 07:16:00",
								  "tags": [
									{"id": "aaaa-aaaa-aaaa-aaaa", "name": "..."},
									{"id": "aaaa-aaaa-aaaa-aaaa", "name": "..."}
								}
								...
							  ]
							}
						  ```  
				- 400 (некорректные параметры)
				- не 403
		- /{id} (GET) - получение поста по id  
			- заголовки: нет, токен не нужен  
			- ответы:  
				- 200  
					- тело: 
						- { "id": "aaaa-aaaa-aaaa-aaaa", ... } (как item выше)  
				- 404 (пост не найден)  
		- (POST) - создание поста (только админы)  
			- тело: 
				- ```json
				  { 
					  "category_id": str,
					  "title": str, 
					  "short_description": str?, 
					  "description": str?, 
					  "status": str?, 
					  "tag_ids": [str,...]? 
				  } 
				   ```
			- ответы:  
				- 201  
					- тело: { "id": str .....}  
				- 400 (некорректные данные)  
				- 403 (не админ)  
		- /{id} (PATCH) - обновление поста (только админы)  
			- тело: в формате [JSONPATCH](http://jsonpatch.com/)
			- ответы:  
				- 200  
					- тело: { "id": str, ...... }  
				- 404  
				- 403  
				- 400  
		- /{id} (DELETE) - удаление поста (только админы)  
			- ответы:  
				- 204  
				- 404  
				- 403  
	
	- /{posts|events|couses}/categories  
		- ?{параметры пагинации} (GET) - список категорий  
			- заголовки: нет, токен не нужен
			- ответы:  
				- 200  
					- тело: 
						- ```json
							{  
							    // обертка
								"items": [  
							        {  
							            "id": str,  
							            "name": str,  
							        },  
							        ...  
							    ]  
							}
						  ```
				- 400
				- возможно 403 - дать смотреть только админам
		- (POST) - создание (админы)  
			- тело: { "name": str }  
			- ответы:  
				- 201 {id:str, name:str}  
				- 400  
				- 403 
				- 409 (если категория с таким именем уже есть)
		- /{id} (PATCH) - обновление (админы)  
			- тело: в формате [JSONPATCH](http://jsonpatch.com/)
			- ответы:  
				- 200  
				- /400/403/404
		- /{id} (DELETE) - удаление (админы)  
			- ответы:  
				- 204  
				- 404/403  
	
	- /{posts|events|couses}/tags  
		- все ровно то же самое, что и для категорий




